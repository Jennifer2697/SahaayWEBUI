<!DOCTYPE html>
<html lang="en">

<head>
  <title> Sahaay </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="shortcut icon" href="/images/logo_c.png" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
  <script>
    $(function(){
        $("#header").load("/header"); 
      });
    </script>
  <style>
    .map {
        height: 35vw;
        width: 48vw;
      }
    </style>
</head>

<body>
  <div id="header"></div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-2">
        <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">Filters for Hospitals</div>
            <div class="panel-body">
              <button type="button" class="btn btn-default" div="showNearest">Show nearest</button><br><br>
              <div class="form-group">
                <label for="distanceRadius">Distance radius:</label>
                <select class="form-control" id="distanceRadius">
                  <option value="0" selected>None</option>
                  <option value="1">1 km</option>
                  <option value="2">2 km</option>
                  <option value="3">3 km</option>
                  <option value="4">4 km</option>
                  <option value="5">5 km</option>
                  <option value="6">6 km</option>
                  <option value="7">7 km</option>
                </select>
              </div>
              <h5><b>Category: </b></h5>
              <div class="radio">
                <label><input type="radio" name="optradio" checked>All</label>
              </div>
              <div class="radio">
                <label><input type="radio" name="optradio">Public</label>
              </div>
              <div class="radio">
                <label><input type="radio" name="optradio">Private</label>
              </div>
              <div class="radio">
                <label><input type="radio" name="optradio">Semi-private</label>
              </div>
              <h5><b>Services: </b></h5>
              <div class="checkbox">
                <label><input type="checkbox" value="">Burn care unit</label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="">Cardiology</label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="">Neurology</label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="">Maternity ward </label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="">Ophthalmology</label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="">Orthopaedics</label>
              </div>
              <h5><b>Budget Range:</b></h5>
              <div class="form-group row">
                <div class="col-sm-6">
                  <label for="fromrange"> From(₹)</label>
                  <input class="form-control" id="fromrange" type="text">
                </div>
                <div class="col-sm-6">
                  <label for="torange"> To(₹)</label>
                  <input class="form-control" id="torange" type="text">
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">Advanced Report Generation</div>
            <div class="panel-body">Generate Reports</div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div id="map" class="map"></div>
        <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoibWVkaWFzc2lzdGFuY2UiLCJhIjoiY2pyaXhuNnNxMDY3YTN6cHRsbDMwdjNxbyJ9.OPyPVypR_ZajltuSCNiltA';
        var map = L.map('map').fitWorld();

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
          maxZoom: 18,
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
          id: 'mapbox.streets'
        }).addTo(map);


        function onLocationFound(e) {
          L.marker(e.latlng).addTo(map);
          var filterCircle;

          var myLayer = L.mapbox.featureLayer().loadURL('/data/kurla.geojson');
          myLayer.on('ready', function(e) {
            var clusterGroup = new L.markerClusterGroup();
            clusterGroup.on('click', function(a) {
              console.log(a.layer.feature.properties);
              $("#hospital_name").html(a.layer.feature.properties.name);
              $("#hospital_address").html(a.layer.feature.properties.address);
              $("#hospital_category").html(a.layer.feature.properties.category);
              //$("#hospital_speciality").html(a.layer.feature.properties.speciality);
              //$("#hospital_services").html(a.layer.feature.properties.services);
              $("#hospital_timings").html(a.layer.feature.properties.timings);
              $("#hospital_contact").html(a.layer.feature.properties.contact_no);
              //$("#hospital_ratings").html(a.layer.feature.properties.ratings);

            });

            clusterGroup.on('clusterclick', function(a) {
              console.log('cluster ' + a.layer.getAllChildMarkers().length);
            });
            e.target.eachLayer(function(layer) {
              clusterGroup.addLayer(layer);
            });
            map.addLayer(clusterGroup);
            //map.fitBounds(myLayer.getBounds());
            myLayer.eachLayer(function(layer) {
              layer.bindPopup('<strong>' + layer.feature.properties.name + '</strong>', { closeButton: true });
            });
            myLayer.on('click', function(e) {
              e.layer.openPopup();
            });
          });


          $("#distanceRadius").on('change', function(x) {
            var radius = $("#distanceRadius").val() * 1000;
            if (filterCircle != undefined) {
              map.removeLayer(filterCircle);
            };
            if (radius != 0) {
              filterCircle = new L.circle(e.latlng, radius, {
                opacity: 1,
                weight: 1,
                fillOpacity: 0.3
              }).addTo(map);
              filterCircle.setLatLng(e.latlng);

              myLayer.setFilter(showInDistanceRange);
            }
          });

          function showInDistanceRange(feature) {
            var radius = $("#distanceRadius").val() * 1000;
            return e.latlng.distanceTo(L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0])) < radius;
          }
        }


        function onLocationError(e) {
          alert(e.message);
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        map.locate({ setView: true, maxZoom: 15 });
        </script>
      </div>
      <div class="col-lg-4">
        <h2 align="center" id='hospital_name'>-</h2>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Distance</th>
                <th>-</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Address</td>
                <td id='hospital_address'>-</td>
              </tr>
              <tr>
                <td>Category</td>
                <td id='hospital_category'>-</td>
              </tr>
              <tr>
                <td>Speciality</td>
                <td id='hospital_speciality'>-</td>
              </tr>
              <tr>
                <td>Services</td>
                <td id='hospital_services'>-</td>
              </tr>
              <tr>
                <td>Timings</td>
                <td id='hospital_timings'>-</td>
              </tr>
              <tr>
                <td>Contact</td>
                <td id='hospital_contact'>-</td>
              </tr>
              <tr>
                <td>Ratings</td>
                <td id='hospital_ratings'>-</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</body>

</html>